{% extends 'home.html' %}
{% load widget_tweaks %}
{% block content %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
.login-box {
    margin-top: 10vh;
}

.login-box {
    width: 100px;
    margin: 7% auto;
}
.login-logo img {
    width: 100px;
}
.login-card-body {
    display: flex;
    flex-direction: column;
    align-items: center;
}
.login-box-msg {
    font-size: 1.5rem;
    font-family: 'Arial', sans-serif;
    font-weight: bold;
}
.form-group {
    width: 100%;
}
.btn-primary {
    width: 100%;
}



.login-card-body {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.login-box-msg {
    font-size: 20px;
    font-family: 'Arial', sans-serif;
    font-weight: bold;
}
.input-group .form-control {
  border-radius: 0.25rem;
}
.input-group .input-group-text {
  border-radius: 0.25rem;
}

.card {
    max-width: 400px; /* Ajusta este valor según tus necesidades */
    margin: auto;
}
</style>
<div class="card">
    <div class="card-body">
        <center><h3>Editar Información del Usuario</h3></center>
        <form method="post" action="{% url 'user_info:user_edit' request.user.id %}" id="edit-form">
            {% csrf_token %}
            
            <!-- Campo de nombre de usuario -->
            <div class="form-group">
                {{ EditUserInfo.username.label_tag }}
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                    </div>
                    {{ EditUserInfo.username }}
                </div>
            </div>
        
            <!-- Campo de nombre -->
            <div class="form-group">
                {{ EditUserInfo.first_name.label_tag }}
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text"><i class="fas fa-user-tag"></i></span>
                    </div>
                    {{ EditUserInfo.first_name }}
                </div>
            </div>
        
            <!-- Campo de apellido -->
            <div class="form-group">
                {{ EditUserInfo.last_name.label_tag }}
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text"><i class="fas fa-user-friends"></i></span>
                    </div>
                    {{ EditUserInfo.last_name }}
                </div>
            </div>
        
            <!-- Campo de contraseña -->
            <div class="form-group">
                {{ EditUserInfo.password.label_tag }}
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text"><i class="fas fa-lock"></i></span>
                    </div>
                    {{ EditUserInfo.password }}
                    <div class="input-group-append">
                        <button type="button" class="btn btn-outline-secondary" id="toggle-password">
                            <i class="fas fa-eye" id="password-icon"></i>
                        </button>
                    </div>
                </div>
            </div>
        
            <!-- Campo de confirmación de contraseña -->
            <div class="form-group">
                {{ EditUserInfo.password2.label_tag }}
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text"><i class="fas fa-lock"></i></span>
                    </div>
                    {{ EditUserInfo.password2 }}
                    <div class="input-group-append">
                        <button type="button" class="btn btn-outline-secondary" id="toggle-password2">
                            <i class="fas fa-eye" id="password-icon2"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
        </form>
    </div>
</div>
<!-- <script>
    document.getElementById('toggle-password').addEventListener('click', function () {
        var passwordField = document.getElementById('id_password');
        var passwordFieldType = passwordField.getAttribute('type');
        if (passwordFieldType === 'password') {
            passwordField.setAttribute('type', 'text');
            this.innerHTML = '<i class="fas fa-eye-slash"></i>';
        } else {
            passwordField.setAttribute('type', 'password');
            this.innerHTML = '<i class="fas fa-eye"></i>';
        }
    });
</script> -->

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const userId = "{{ request.user.id }}"; // Obtén el ID del usuario autenticado desde el contexto de Django

        // Cambia dinámicamente el atributo 'action' del formulario
        document.getElementById('edit-form').setAttribute('action', `/inventory/asset_edit/${userId}/`);

        // Si necesitas realizar otras acciones, como rellenar campos, puedes hacerlo aquí
        fetch(`/user_info/get_user_data/${userId}/`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('edit_username').value = data.username;
            // Nota: No es seguro rellenar el campo de contraseña con datos sensibles
        })
        .catch(error => {
            console.error('Error al obtener los datos del usuario:', error);
        });
    });

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const userId = "{{ request.user.id }}"; // Obtén el ID del usuario autenticado desde el contexto de Django

        // Cambia dinámicamente el atributo 'action' del formulario
        document.getElementById('edit-form').setAttribute('action', `/user_info/user_edit/${userId}/`);
    });
</script>

<script>
    // Mostrar mensajes de éxito o error usando SweetAlert2
    {% if messages %}
        {% for message in messages %}
            Swal.fire({
                icon: "{% if message.tags == 'success' %}success{% elif message.tags == 'error' %}error{% endif %}",
                title: "{% if message.tags == 'success' %}¡Éxito!{% elif message.tags == 'error' %}¡Error!{% endif %}",
                text: "{{ message }}",
                confirmButtonText: "Aceptar"
            });
        {% endfor %}
    {% endif %}
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('edit-form');

        form.addEventListener('submit', function (event) {
            event.preventDefault(); // Evita el envío inmediato del formulario

            Swal.fire({
                title: '¿Estás seguro?',
                text: "¿Deseas guardar los cambios realizados?",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sí, guardar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire(
                        '¡Guardado!',
                        'La información del usuario se ha actualizado correctamente.',
                        'success'
                    ).then(() => {
                        form.submit(); // Envía el formulario después de la confirmación
                    });
                }
            });
        });
    });
</script>
<!-- script funcionalidad del ojo V.Parra -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const togglePassword = document.getElementById('toggle-password');
        const passwordField = document.getElementById('edit_password');
        const passwordIcon = document.getElementById('password-icon');

        togglePassword.addEventListener('click', function () {
            const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordField.setAttribute('type', type);
            passwordIcon.classList.toggle('fa-eye');
            passwordIcon.classList.toggle('fa-eye-slash');
        });

        const togglePassword2 = document.getElementById('toggle-password2');
        const passwordField2 = document.getElementById('edit_password2');
        const passwordIcon2 = document.getElementById('password-icon2');

        togglePassword2.addEventListener('click', function () {
            const type = passwordField2.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordField2.setAttribute('type', type);
            passwordIcon2.classList.toggle('fa-eye');
            passwordIcon2.classList.toggle('fa-eye-slash');
        });
    });
</script>
{% endblock %}